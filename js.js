var area = [
    [2,0,0,1,2,2,0,1,1,0,0,2,2,2,0,1,2,1,1,0,1,0,1,1,2,1,1,0,0,2,0,1,0,2,1,1,2,0,1,1,0,2,1,1,1],
    [1,1,0,1,2,0,1,1,2,2,1,2,1,2,1,1,0,0,1,2,1,2,0,1,2,1,2,2,2,0,2,2,2,0,0,0,0,2,1,2,1,0,0,0,0],
    [2,1,0,0,0,2,2,2,2,2,2,1,2,2,1,1,2,1,2,0,1,2,1,1,0,0,1,2,1,0,0,2,2,0,2,0,1,1,2,0,2,2,2,0,1],
    [1,1,2,2,0,2,2,0,0,2,2,2,2,2,2,1,0,0,1,1,0,1,1,2,0,0,0,1,2,0,1,2,1,0,2,1,1,2,1,0,1,1,2,1,0],
    [0,2,2,2,1,2,2,1,1,1,2,0,0,2,2,2,0,1,2,0,2,1,1,0,1,0,0,2,0,0,1,2,2,1,2,1,0,2,0,1,2,1,2,2,2],
    [1,0,2,2,1,1,0,2,0,0,2,0,1,1,1,1,2,0,1,2,0,0,1,2,0,1,0,0,1,1,1,1,1,0,2,2,1,0,2,1,1,2,2,1,0],
    [1,2,1,2,2,2,0,1,0,2,0,2,2,1,0,1,2,1,2,2,0,1,1,1,1,0,2,1,2,1,0,1,0,2,2,2,2,1,2,1,0,0,1,0,1],
    [0,1,2,2,0,2,1,2,2,0,2,0,0,0,2,0,2,2,2,1,2,1,0,1,0,2,0,1,0,1,0,2,0,2,1,1,0,2,2,1,2,1,0,1,0],
    [1,1,1,2,1,1,0,2,2,2,1,0,0,1,1,1,2,2,1,0,2,0,0,2,0,2,0,2,0,2,0,0,1,1,1,0,2,2,1,0,2,2,1,2,2],
    [1,2,0,0,0,2,2,2,1,0,1,0,2,1,1,0,1,2,0,1,0,1,2,2,0,2,0,0,0,0,2,2,1,2,2,0,2,1,2,2,1,1,2,0,0],
    [2,2,0,2,2,1,0,0,1,1,2,2,0,0,0,2,1,1,1,0,2,2,2,2,1,1,2,2,1,0,2,2,1,2,1,2,2,1,1,2,2,1,2,1,2],
    [0,1,1,2,2,0,2,1,0,0,2,0,1,1,0,1,0,2,1,2,0,0,1,1,0,0,0,0,1,0,1,2,1,2,0,2,0,0,2,0,0,0,1,2,1],
    [2,1,2,0,0,2,2,1,1,2,2,0,0,1,1,2,2,0,2,2,2,1,1,0,1,1,2,0,1,1,0,2,1,2,0,1,0,2,0,1,1,1,2,0,0],
    [1,0,2,0,0,0,0,1,2,1,1,0,2,2,2,0,1,0,0,2,0,2,0,0,2,2,2,2,1,0,1,2,0,0,2,1,0,0,0,0,2,0,1,1,2],
    [1,1,2,1,1,0,0,2,1,0,2,2,1,0,0,1,0,0,2,0,2,2,2,0,1,2,1,2,2,2,2,0,2,0,0,1,0,1,0,0,0,2,2,0,2],
    [1,1,2,0,2,2,0,2,1,0,2,1,2,0,1,1,1,0,1,0,2,0,1,2,2,0,2,0,2,2,2,2,1,0,2,1,1,2,2,0,2,0,1,2,1],
    [2,1,1,1,1,2,2,1,2,0,1,2,0,1,2,2,2,0,1,1,0,2,1,0,2,0,2,1,1,0,1,2,1,1,2,2,1,1,0,2,0,0,2,0,1],
    [1,1,1,2,0,2,0,2,1,0,2,2,0,2,1,0,0,0,2,1,1,1,2,1,2,1,1,2,2,1,2,0,1,1,0,2,1,1,0,0,0,2,2,0,2],
    [0,0,1,2,2,2,0,2,1,2,0,1,2,0,2,1,1,0,0,0,1,0,2,1,2,2,2,2,1,0,2,1,1,1,2,1,2,2,2,1,2,1,2,1,0],
    [0,1,1,1,2,2,2,2,2,1,2,0,0,2,0,0,0,0,1,0,2,2,0,1,0,1,1,0,2,1,0,1,0,1,2,0,0,1,2,1,2,2,2,0,2],
    [0,2,0,2,1,1,0,1,0,1,0,0,0,0,0,0,1,0,1,0,0,0,1,0,2,2,2,1,2,1,2,0,0,1,0,1,1,1,0,2,0,0,2,0,1],
    [2,0,0,1,0,1,1,0,2,1,0,1,2,2,1,2,2,1,2,1,0,0,1,0,1,1,2,2,1,0,0,0,0,2,0,1,1,2,1,2,1,2,0,2,2],
    [0,2,2,1,2,1,1,0,2,0,2,1,0,0,1,1,2,2,2,0,0,0,2,1,0,1,0,2,2,0,0,2,2,0,1,2,2,0,1,2,2,2,1,1,1],
    [2,1,2,2,1,1,0,1,1,2,0,2,1,1,1,0,1,0,2,0,2,2,2,1,2,2,1,0,0,1,0,1,0,0,0,0,1,0,1,1,2,1,0,1,0],
    [2,1,2,0,1,0,2,1,1,1,0,1,0,0,1,2,0,0,0,2,1,2,0,0,1,2,1,1,0,0,0,2,1,0,2,0,2,2,1,0,1,2,2,2,0],
    [1,0,2,2,1,2,0,0,2,2,0,0,1,2,1,2,0,1,1,0,0,0,2,0,1,0,0,2,2,1,1,2,1,0,2,1,1,1,2,0,0,1,2,1,1],
    [2,1,0,0,1,0,1,1,1,2,1,1,1,1,1,1,1,0,0,1,1,2,0,2,2,0,1,1,0,0,2,0,1,2,1,2,2,1,1,0,2,1,2,0,0],
    [0,0,2,1,1,1,1,1,2,0,0,0,0,0,0,1,0,0,1,0,0,0,2,0,1,1,2,2,0,1,2,2,2,2,2,0,1,0,1,1,1,2,1,1,0],
    [2,2,1,0,1,2,0,1,0,2,0,0,2,2,2,1,1,1,0,1,0,0,1,1,0,0,2,2,2,2,1,1,1,2,2,2,1,2,1,2,2,1,2,2,1],
    [0,2,1,1,0,2,1,0,0,0,1,0,0,2,1,2,0,1,1,1,1,2,2,2,0,0,1,2,1,1,1,0,1,2,0,0,1,1,2,2,0,0,1,2,0],
    [2,1,2,0,2,1,0,1,1,0,1,0,1,1,0,1,2,2,1,2,0,2,1,2,0,1,2,2,1,0,1,0,0,1,1,1,2,1,1,0,1,2,2,1,1],
    [0,2,0,1,1,0,1,2,2,2,2,2,2,0,0,1,0,2,0,2,0,2,2,0,1,1,0,1,0,0,1,2,2,0,2,2,2,0,0,0,2,1,0,1,1],
    [1,2,1,0,1,1,0,2,2,1,1,2,0,0,2,0,2,1,2,1,0,0,1,0,1,2,2,2,0,2,2,2,1,1,2,2,2,0,1,2,0,0,2,2,1],
    [0,2,0,0,2,2,2,1,0,1,1,0,1,2,2,1,1,1,0,2,2,1,1,0,0,0,2,0,2,1,2,1,2,1,1,2,2,1,0,2,2,0,0,0,1],
    [1,1,1,2,1,2,2,1,2,2,1,0,2,0,1,0,1,1,1,1,2,1,2,0,2,1,2,0,1,2,1,0,1,2,2,2,0,1,1,1,0,2,0,2,2],
    [2,0,1,1,1,0,2,1,1,1,0,1,0,2,0,2,1,0,2,1,1,2,2,0,2,2,0,2,0,1,2,0,0,0,0,0,1,1,2,2,1,1,2,0,2],
    [0,0,1,1,2,2,2,0,0,1,2,0,0,2,2,0,2,1,0,1,2,1,2,1,2,1,2,0,0,0,2,2,2,1,1,2,2,1,0,1,0,0,2,2,0],
    [2,0,2,0,1,1,2,2,1,0,2,0,2,1,1,2,1,0,0,2,0,1,1,1,0,0,1,0,1,1,1,2,0,1,2,0,0,0,1,1,2,0,0,1,1],
    [1,2,0,2,2,2,2,1,0,0,0,1,0,2,1,0,2,0,0,1,2,0,1,1,0,2,0,1,2,2,0,1,0,2,1,1,0,0,2,2,2,0,0,1,2],
    [1,2,1,0,0,0,2,2,0,1,1,0,1,2,0,1,1,2,0,2,2,1,0,0,2,2,1,1,1,2,2,2,0,2,1,2,2,1,1,1,1,1,2,0,0],
    [1,2,1,1,0,0,1,2,1,2,0,2,0,1,1,2,0,1,1,2,1,0,2,0,0,1,2,0,2,1,0,1,2,0,0,0,2,0,0,1,0,0,1,2,1],
    [0,2,0,0,2,1,0,1,1,2,0,0,0,0,1,1,0,0,2,2,1,2,0,0,0,2,0,0,0,1,0,1,2,2,0,2,2,0,0,0,2,0,1,0,0],
    [0,2,2,1,2,0,2,1,0,0,0,2,2,2,2,0,2,0,2,1,2,0,1,0,2,1,2,0,2,2,0,0,2,0,0,0,1,2,0,1,1,2,2,1,2],
    [0,2,1,0,2,0,0,2,2,0,2,0,1,2,1,0,2,2,0,0,0,2,2,1,2,2,0,0,0,0,2,1,0,0,1,1,0,0,2,2,0,1,0,2,0],
    [2,2,0,1,0,2,2,1,1,2,0,0,0,1,2,2,0,1,1,0,1,0,1,0,2,0,2,2,1,0,2,2,2,0,2,0,0,1,0,0,2,0,1,1,0]
    ];
var face=[22,22];
var direction=[0,1];
var length=7;
var oneInputFlag=0;
var pauseFlag=0;
var score=0;
var record=0;

function color(pixel){
    if (pixel == 0) return "white"
    if (pixel == 99999) return "red"
    return "black"
}

function Pause(){
    if (pauseFlag == 0) {
        pauseFlag = 1;
        clearInterval(myLoop);
        console.log("clearInterval");
    } else {
        pauseFlag = 0;
        myLoop = setInterval(main,speed);
        console.log("setInterval");
    }
}
function fill() {
    let window=document.getElementById('game');
    window.innerHTML="";
    for (var x = 0; x<45; x++) {
        for (var y = 0; y<45; y++) {
           // if (area[x][y]==1) {area[x][y]=0} else if (area[x][y]==0) area[x][y]=1; 
            window.insertAdjacentHTML("beforeend","<div class="+color(area[x][y])+">.</div>");
        }    
    }
}
function reset(){
    //clearInterval(myLoop);
    for (var x = 0; x<45; x++) {
        for (var y = 0; y<45; y++) {
            area[x][y]=0;
        }    
    }
    length=7;
    for (x = 1; x<=length; x++) area[22][x+17]=x;
    area[40][40]=99999;
    face=[22,24];
    direction=[0,1];
    score=-1;
    adjustScore();
    Pause();
    fill();
    //fill();
    //myLoop=setInterval(main,speed);
}
function gameOver() {
    clearInterval(myLoop);
    console.log("gameOver");
}
function newTarget(){
    length+=1;
    console.log("newTarget");
    area[face[0]][face[1]]=length;
    let x=0;
    let y=0;
    while (area[x][y]!=99999) {
        x=Math.floor(Math.random() * 45);
        y=Math.floor(Math.random() * 45);
        if (area[x][y]==0) area[x][y]=99999;
    }
    adjustScore();
}
function move(){
    //console.log(area[face[0]][face[1]], length);
    face[0] += direction[0]+45;
    face[1] += direction[1]+45;
    face[0] %=45;
    face[1] %=45;
    //console.log(face[0],face[1],area[face[0]][face[1]]);
    if (area[face[0]][face[1]]==99999) newTarget() 
    else if((area[face[0]][face[1]]==0)) {
        for (var x = 0; x<45; x++) {
            for (var y = 0; y<45; y++) {
                if ((area[x][y] != 99999) && (area[x][y] != 0)) {area[x][y]-=1;}
            }    
        }
        area[face[0]][face[1]]=length;
    } else gameOver();
}

document.addEventListener('keydown', function(event) {
    if (oneInputFlag == 0) {
    switch (event.code) {
        case "ArrowUp": case "KeyW": if (direction[0] != 1){direction=[-1,0]; oneInputFlag=1;}
        break;
        case "ArrowDown": case "KeyS": if (direction[0] != -1) {direction=[1,0]; oneInputFlag=1;};
        break;
        case "ArrowRight": case "KeyD": if (direction[1] != -1) {direction=[0,1]; oneInputFlag=1;};
        break;
        case "ArrowLeft": case "KeyA": if (direction[1] != 1) {direction=[0,-1]; oneInputFlag=1;};
        break;
    }
    }
    if (event.code == "Space") Pause();

  });

function main(){
    move();
    fill();
    oneInputFlag=0;
}

function adjustScore(){
    score +=1;
    if (record<score) record=score;
    let doc=document.getElementById('record');
    doc.innerHTML="Score: <strong>"+score+"</strong><br>Your record: <strong>"+record+"</strong>";
}
var speed=20;
var myLoop = setInterval(main,speed);
console.log(speed);
console.log("test");